<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US-7: 策略複製功能測試</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .copy-success {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .test-result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">
            <i class="fas fa-clipboard-check text-primary"></i>
            US-7: 策略複製功能測試
        </h1>
        
        <div class="alert alert-info">
            <strong>測試目標:</strong> 驗證策略推薦卡片的複製功能
            <ul class="mb-0 mt-2">
                <li>✅ 複製按鈕正確顯示</li>
                <li>✅ 點擊按鈕複製策略參數</li>
                <li>✅ 顯示複製成功提示</li>
                <li>✅ 支持現代瀏覽器和舊版瀏覽器</li>
            </ul>
        </div>
        
        <!-- 測試區域 1: 策略推薦卡片 -->
        <div class="test-section">
            <h3>測試 1: 策略推薦卡片</h3>
            <p class="text-muted">模擬實際的策略推薦顯示</p>
            
            <div id="strategyRecommendations">
                <!-- 策略 1: Long Call -->
                <div class="card mb-2 border-start border-4 border-success">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h6 class="mb-0 fw-bold">Long Call (買入認購)</h6>
                            <div>
                                <span class="badge bg-success me-1">Bullish</span>
                                <button class="btn btn-sm btn-outline-primary copy-strategy-btn" 
                                        data-strategy="Long Call (買入認購)"
                                        data-strike="105.00"
                                        data-expiry="2026-06-19"
                                        data-direction="Bullish"
                                        data-confidence="High"
                                        title="複製策略參數">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span class="copy-success ms-1" style="display: none; color: #28a745; font-size: 0.9em;">
                                    <i class="fas fa-check"></i> 已複製
                                </span>
                            </div>
                        </div>
                        <div class="small text-warning mb-1">★★★ 信心度: High</div>
                        <p class="small mb-1 text-muted">趨勢向上 • IV 偏低，適合買入期權 • 風險回報比優秀 (5.00:1)</p>
                        <div class="small bg-light p-1 rounded">
                            <strong>建議行使價:</strong> 105.00 | <span class="text-danger">止損: 93.10</span> | <span class="text-success">目標: 120.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- 策略 2: Short Put -->
                <div class="card mb-2 border-start border-4 border-success">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h6 class="mb-0 fw-bold">Short Put (沽出認沽)</h6>
                            <div>
                                <span class="badge bg-success me-1">Bullish</span>
                                <button class="btn btn-sm btn-outline-primary copy-strategy-btn" 
                                        data-strategy="Short Put (沽出認沽)"
                                        data-strike="95.00"
                                        data-expiry="2026-06-19"
                                        data-direction="Bullish"
                                        data-confidence="Medium"
                                        title="複製策略參數">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span class="copy-success ms-1" style="display: none; color: #28a745; font-size: 0.9em;">
                                    <i class="fas fa-check"></i> 已複製
                                </span>
                            </div>
                        </div>
                        <div class="small text-warning mb-1">★★ 信心度: Medium</div>
                        <p class="small mb-1 text-muted">趨勢向上 • IV 偏高，適合沽出期權 • 風險回報比 1.50:1</p>
                        <div class="small bg-light p-1 rounded">
                            <strong>建議行使價:</strong> 95.00 | <span class="text-danger">止損: 85.00</span> | <span class="text-success">目標: 105.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- 策略 3: Long Put -->
                <div class="card mb-2 border-start border-4 border-danger">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h6 class="mb-0 fw-bold">Long Put (買入認沽)</h6>
                            <div>
                                <span class="badge bg-danger me-1">Bearish</span>
                                <button class="btn btn-sm btn-outline-primary copy-strategy-btn" 
                                        data-strategy="Long Put (買入認沽)"
                                        data-strike="95.00"
                                        data-expiry="2026-06-19"
                                        data-direction="Bearish"
                                        data-confidence="Medium"
                                        title="複製策略參數">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span class="copy-success ms-1" style="display: none; color: #28a745; font-size: 0.9em;">
                                    <i class="fas fa-check"></i> 已複製
                                </span>
                            </div>
                        </div>
                        <div class="small text-warning mb-1">★★ 信心度: Medium</div>
                        <p class="small mb-1 text-muted">趨勢向下 • IV 偏低，適合買入期權 • 風險回報比 2.30:1</p>
                        <div class="small bg-light p-1 rounded">
                            <strong>建議行使價:</strong> 95.00 | <span class="text-danger">止損: 105.00</span> | <span class="text-success">目標: 80.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 測試區域 2: 手動測試按鈕 -->
        <div class="test-section">
            <h3>測試 2: 手動測試</h3>
            <p class="text-muted">點擊按鈕測試複製功能</p>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <button class="btn btn-primary w-100" onclick="testModernAPI()">
                        <i class="fas fa-clipboard"></i> 測試現代 Clipboard API
                    </button>
                </div>
                <div class="col-md-6 mb-3">
                    <button class="btn btn-secondary w-100" onclick="testLegacyAPI()">
                        <i class="fas fa-clipboard-list"></i> 測試降級方案 (execCommand)
                    </button>
                </div>
            </div>
            
            <div id="testResult"></div>
        </div>
        
        <!-- 測試區域 3: 瀏覽器兼容性 -->
        <div class="test-section">
            <h3>測試 3: 瀏覽器兼容性檢查</h3>
            <p class="text-muted">檢測當前瀏覽器支持的複製方法</p>
            
            <div id="browserCompatibility"></div>
        </div>
        
        <!-- 測試區域 4: 複製內容預覽 -->
        <div class="test-section">
            <h3>測試 4: 複製內容預覽</h3>
            <p class="text-muted">查看複製到剪貼板的內容格式</p>
            
            <button class="btn btn-info mb-3" onclick="showCopyPreview()">
                <i class="fas fa-eye"></i> 顯示複製內容預覽
            </button>
            
            <div id="copyPreview"></div>
        </div>
    </div>
    
    <!-- 引入複製功能腳本 -->
    <script src="../static/js/copy-strategy.js"></script>
    
    <!-- 測試腳本 -->
    <script>
        // 頁面加載完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 附加複製按鈕監聽器
            attachCopyStrategyListeners();
            
            // 檢查瀏覽器兼容性
            checkBrowserCompatibility();
        });
        
        // 測試現代 Clipboard API
        async function testModernAPI() {
            const testText = '測試文本 - 現代 Clipboard API';
            const success = await copyToClipboardModern(testText);
            
            const resultDiv = document.getElementById('testResult');
            if (success) {
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <i class="fas fa-check-circle"></i> 
                        <strong>成功:</strong> 現代 Clipboard API 工作正常<br>
                        已複製: "${testText}"
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <i class="fas fa-times-circle"></i> 
                        <strong>失敗:</strong> 現代 Clipboard API 不可用或被阻止<br>
                        可能原因: 瀏覽器不支持或需要 HTTPS
                    </div>
                `;
            }
        }
        
        // 測試降級方案
        function testLegacyAPI() {
            const testText = '測試文本 - execCommand 降級方案';
            const success = copyToClipboardLegacy(testText);
            
            const resultDiv = document.getElementById('testResult');
            if (success) {
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <i class="fas fa-check-circle"></i> 
                        <strong>成功:</strong> execCommand 降級方案工作正常<br>
                        已複製: "${testText}"
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <i class="fas fa-times-circle"></i> 
                        <strong>失敗:</strong> execCommand 方法失敗<br>
                        這種情況很少見，可能是瀏覽器限制
                    </div>
                `;
            }
        }
        
        // 檢查瀏覽器兼容性
        function checkBrowserCompatibility() {
            const compatDiv = document.getElementById('browserCompatibility');
            
            const hasClipboardAPI = !!(navigator.clipboard && navigator.clipboard.writeText);
            const hasExecCommand = document.queryCommandSupported && document.queryCommandSupported('copy');
            
            let html = '<div class="row">';
            
            // Clipboard API
            html += `
                <div class="col-md-6 mb-2">
                    <div class="alert ${hasClipboardAPI ? 'alert-success' : 'alert-warning'}">
                        <i class="fas ${hasClipboardAPI ? 'fa-check' : 'fa-exclamation-triangle'}"></i>
                        <strong>Clipboard API:</strong> ${hasClipboardAPI ? '支持' : '不支持'}
                        ${!hasClipboardAPI ? '<br><small>需要 HTTPS 或 localhost</small>' : ''}
                    </div>
                </div>
            `;
            
            // execCommand
            html += `
                <div class="col-md-6 mb-2">
                    <div class="alert ${hasExecCommand ? 'alert-success' : 'alert-danger'}">
                        <i class="fas ${hasExecCommand ? 'fa-check' : 'fa-times'}"></i>
                        <strong>execCommand:</strong> ${hasExecCommand ? '支持' : '不支持'}
                        ${hasExecCommand ? '<br><small>降級方案可用</small>' : ''}
                    </div>
                </div>
            `;
            
            html += '</div>';
            
            // 瀏覽器信息
            html += `
                <div class="alert alert-info">
                    <strong>瀏覽器信息:</strong><br>
                    User Agent: ${navigator.userAgent}<br>
                    協議: ${window.location.protocol}
                </div>
            `;
            
            compatDiv.innerHTML = html;
        }
        
        // 顯示複製內容預覽
        function showCopyPreview() {
            const testData = {
                strategy: 'Long Call (買入認購)',
                strike: '105.00',
                expiry: '2026-06-19',
                direction: 'Bullish',
                confidence: 'High'
            };
            
            const copyText = formatCopyText(testData);
            
            const previewDiv = document.getElementById('copyPreview');
            previewDiv.innerHTML = `
                <div class="alert alert-secondary">
                    <strong>複製內容格式:</strong>
                    <pre class="mb-0 mt-2" style="background: #f8f9fa; padding: 10px; border-radius: 4px;">${copyText}</pre>
                </div>
            `;
        }
    </script>
</body>
</html>
